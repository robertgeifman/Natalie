//
//  main.swift
//  Natalie
//
//  Created by Marcin Krzyzanowski on 07/08/16.
//  Copyright Â© 2016 Marcin Krzyzanowski. All rights reserved.
//

import Foundation

func printUsage() {
    print("Usage:")
    print("natalie <storyboard-path or directory>")
}

if CommandLine.arguments.count == 1 {
    printUsage()
    exit(1)
}

var filePaths: [String] = []
let storyboardSuffix = ".storyboard"

for arg in CommandLine.arguments.dropFirst() {
    if arg == "--help" {
        printUsage()
        exit(0)
    } else if arg.hasSuffix(storyboardSuffix) {
        filePaths.append(arg)
    } else if let s = findStoryboards(rootPath: arg, suffix: storyboardSuffix) {
        filePaths.append(contentsOf: s)
    }
}

let storyboardFiles = filePaths.compactMap { try? StoryboardFile(filePath: $0) }

let output = Natalie.process(storyboards: storyboardFiles)
print(output.joined(separator: "\n"))

// swiftlint:disable line_length
let natalieBase64String = "Ly8KLy8gIENyZWF0ZWQgYnkgTWFyY2luIEtyenl6YW5vd3NraSBvbiAwNy8wOC8xNi4KLy8gIENvcHlyaWdodCDCqSAyMDE2IE1hcmNpbiBLcnp5emFub3dza2kuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vCi8vICBBZGp1c3RlZCB0byB0aGUgbmVlZHMgb2Ygc3BlY2lmaWMgcHJvamVjdHMgYnkgUm9iZXJ0IEdlaWZtYW4gaW4gMjAxOAovLwoKaW1wb3J0IENvY29hCmltcG9ydCBDcm9zc0tpdAoKZmlsZXByaXZhdGUgZXh0ZW5zaW9uIE9wdGlvbmFsIHdoZXJlIFdyYXBwZWQgPT0gU3RyaW5nIHsKCXZhciB1bndyYXBwZWRTdHJpbmdWYWx1ZTogU3RyaW5nIHsKCQlzd2l0Y2ggc2VsZiB7CgkJY2FzZSAubm9uZTogcmV0dXJuICJuaWwiCgkJY2FzZSAuc29tZShsZXQgdmFsdWUpOiByZXR1cm4gIlwodmFsdWUpIgoJCX0KCX0KfQoKZXh0ZW5zaW9uIFNlcXVlbmNlIHsKICBmdW5jIGZpcnN0PFJlc3VsdD4oXyBpc01hdGNoOiAoSXRlcmF0b3IuRWxlbWVudCkgLT4gUmVzdWx0PykgLT4gUmVzdWx0PyB7CiAgICBmb3IgZWxlbWVudCBpbiBzZWxmIHsKICAgICAgaWYgbGV0IHJlc3VsdCA9IGlzTWF0Y2goZWxlbWVudCkgewogICAgICAgIHJldHVybiByZXN1bHQKICAgICAgfQogICAgfQoKICAgIHJldHVybiBuaWwKICB9Cn0KCmV4dGVuc2lvbiBDb2xsZWN0aW9uIHsKICB2YXIgc2Vjb25kOiBJdGVyYXRvci5FbGVtZW50PyB7CiAgICByZXR1cm4gaW5kZXgoc3RhcnRJbmRleCwgb2Zmc2V0Qnk6IDEsIGxpbWl0ZWRCeTogZW5kSW5kZXgpLm1hcCB7IHNlbGZbJDBdIH0KICB9Cn0KCmV4dGVuc2lvbiBOU09iamVjdCB7CiAgQG5vbm9iamMgZmluYWwgZnVuYyBhc3BlY3RfaG9vayhfIHNlbGVjdG9yOiBTZWxlY3Rvciwgb3B0aW9uczogQXNwZWN0T3B0aW9ucywgYm9keTogQGNvbnZlbnRpb24oYmxvY2spIEBlc2NhcGluZyAoQXNwZWN0SW5mbykgLT4gVm9pZCkgdGhyb3dzIC0+IEFzcGVjdFRva2VuIHsKICAgIHJldHVybiB0cnkgc2VsZi5hc3BlY3RfaG9vayhzZWxlY3Rvciwgd2l0aDogb3B0aW9ucywgdXNpbmdCbG9jazogdW5zYWZlQml0Q2FzdChib2R5LCB0bzogTlNPYmplY3Quc2VsZikpCiAgfQp9CgojaWYgb3MobWFjT1MpCi8vcHVibGljIGVudW0gTmF0YWxpZSB7CnB1YmxpYyBwcm90b2NvbCBBbnlTZWd1ZSB7Cgl2YXIgaWRlbnRpZmllcjogTlNTdG9yeWJvYXJkU2VndWUuSWRlbnRpZmllcj8geyBnZXQgfQoJdmFyIGtpbmQ6IFNlZ3VlS2luZCB7IGdldCB9Cgl2YXIgdHlwZTogTlNWaWV3Q29udHJvbGxlci5UeXBlIHsgZ2V0IH0KfQoKcHVibGljIHN0cnVjdCBTZWd1ZTxEZXN0aW5hdGlvbjogTlNWaWV3Q29udHJvbGxlcj46IEFueVNlZ3VlIHsKCXB1YmxpYyBsZXQgaWRlbnRpZmllcjogTlNTdG9yeWJvYXJkU2VndWUuSWRlbnRpZmllcj8KCXB1YmxpYyBsZXQga2luZDogU2VndWVLaW5kCglwdWJsaWMgdmFyIHR5cGU6IE5TVmlld0NvbnRyb2xsZXIuVHlwZSB7CgkJcmV0dXJuIERlc3RpbmF0aW9uLnNlbGYKCX0KCglwdWJsaWMgaW5pdChfIGlkZW50aWZpZXI6IE5TU3Rvcnlib2FyZFNlZ3VlLklkZW50aWZpZXI/ID0gbmlsLCBraW5kOiBTZWd1ZUtpbmQpIHsKCQlzZWxmLmlkZW50aWZpZXIgPSBpZGVudGlmaWVyCgkJc2VsZi5raW5kID0ga2luZAoJfQp9CgpwdWJsaWMgc3RydWN0IFJldXNhYmxlIHsKCXB1YmxpYyBsZXQgaWRlbnRpZmllcjogU3RyaW5nCglsZXQga2luZDogUmV1c2FibGVLaW5kPwoJbGV0IHR5cGU6IEFueU9iamVjdC5UeXBlCglwdWJsaWMgaW5pdChfIGlkZW50aWZpZXI6IFN0cmluZywgXyBraW5kOiBTdHJpbmcsIF8gdHlwZTogQW55T2JqZWN0LlR5cGUpIHsKCQlzZWxmLmlkZW50aWZpZXIgPSBpZGVudGlmaWVyCgkJc2VsZi5raW5kID0gUmV1c2FibGVLaW5kKHJhd1ZhbHVlOiBraW5kKQoJCXNlbGYudHlwZSA9IHR5cGUKCX0KfQovL30KCnByb3RvY29sIElkZW50aWZpYWJsZVByb3RvY29sXzogRXF1YXRhYmxlIHsKCXZhciBzdG9yeWJvYXJkSWRlbnRpZmllcjogTlNTdG9yeWJvYXJkLlNjZW5lSWRlbnRpZmllcj8geyBnZXQgfQp9CgpleHRlbnNpb24gTlNTdG9yeWJvYXJkU2VndWUgewoJQG5vbm9iamMKCXB1YmxpYyB2YXIgbWF0Y2hQYXR0ZXJuOiAoU3RyaW5nPywgU3RyaW5nPywgU3RyaW5nPywgQW55LCBTdHJpbmc/LCBTdHJpbmc/LCBBbnkpIHsKCQlsZXQgc291cmNlID0gc291cmNlQ29udHJvbGxlciBhcz8gTlNVc2VySW50ZXJmYWNlSXRlbUlkZW50aWZpY2F0aW9uCgkJbGV0IGRlc3RpbmF0aW9uID0gZGVzdGluYXRpb25Db250cm9sbGVyIGFzPyBOU1VzZXJJbnRlcmZhY2VJdGVtSWRlbnRpZmljYXRpb24KCQlsZXQgc3JjU3Rvcnlib2FyZElEOiBTdHJpbmc/ID0gKHNvdXJjZSBhcz8gSWRlbnRpZmlhYmxlUHJvdG9jb2wpPy5zdG9yeWJvYXJkSWRlbnRpZmllcgoJCWxldCBkc3RTdG9yeWJvYXJkSUQ6IFN0cmluZz8gPSAoZGVzdGluYXRpb24gYXM/IElkZW50aWZpYWJsZVByb3RvY29sKT8uc3Rvcnlib2FyZElkZW50aWZpZXIKCQlyZXR1cm4gKGlkZW50aWZpZXIsIHNvdXJjZT8uaWRlbnRpZmllcj8ucmF3VmFsdWUsIHNyY1N0b3J5Ym9hcmRJRC51bndyYXBwZWRTdHJpbmdWYWx1ZSwgc291cmNlQ29udHJvbGxlciwKCQkJZGVzdGluYXRpb24/LmlkZW50aWZpZXI/LnJhd1ZhbHVlLCBkc3RTdG9yeWJvYXJkSUQudW53cmFwcGVkU3RyaW5nVmFsdWUsIGRlc3RpbmF0aW9uQ29udHJvbGxlcikKCX0KCglAbm9ub2JqYwoJcHVibGljIGZpbmFsIGZ1bmMgZGVzdGluYXRpb25WaWV3Q29udHJvbGxlcjxEZXN0aW5hdGlvbjogTlNWaWV3Q29udHJvbGxlcj4ob2ZUeXBlIHR5cGU6IERlc3RpbmF0aW9uLlR5cGUpIC0+IERlc3RpbmF0aW9uPyB7CgkJcmV0dXJuIChkZXN0aW5hdGlvbkNvbnRyb2xsZXIgYXM/IE5TVmlld0NvbnRyb2xsZXIpPy5jaGlsZFZpZXdDb250cm9sbGVyKG9mVHlwZTogdHlwZSkKCX0KfQoKZXh0ZW5zaW9uIE5TV2luZG93Q29udHJvbGxlciB7CglpbnRlcm5hbCB2YXIgc2VndWVDb250cm9sbGVyOiBBbnk/IHsgcmV0dXJuIHNlbGYgfQoKCXB1YmxpYyBmdW5jIHBlcmZvcm08RGVzdGluYXRpb246IE5TVmlld0NvbnRyb2xsZXI+KF8gc2VndWU6IEFueVNlZ3VlLCBwcmVwYXJlOiBAZXNjYXBpbmcgKERlc3RpbmF0aW9uKSAtPiBWb2lkID0geyBfIGluIH0pIHsKCQlndWFyZCBsZXQgaWRlbnRpZmllciA9IHNlZ3VlLmlkZW50aWZpZXIgZWxzZSB7CgkJCWFzc2VydGlvbkZhaWx1cmUoImNhbm5vdCBwZXJmb3JtIHNlZ3VlIFwoc2VndWUua2luZCkgd2l0aCBkZXN0aW5hdGlvbiBcKERlc3RpbmF0aW9uLnNlbGYpIGJlY2F1c2UgaXQgaGFzIG5vIGlkZW50aWZlciIpCgkJCXJldHVybgoJCX0KCgkJZ3VhcmQgc2VndWUudHlwZSA9PSBEZXN0aW5hdGlvbi5zZWxmIGVsc2UgewoJCQlmYXRhbEVycm9yKCJcKHNlZ3VlLnR5cGUpIHNob3VsZCBiZSBzYW1lIGFzIERlc3RpbmF0aW9uIChcKERlc3RpbmF0aW9uLnNlbGYpKSIpCgkJfQoKCQlwZXJmb3JtU2VndWUod2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIpIHsgW3NlZ3VlRGVzY3JpcHRpb24gPSB7IFN0cmluZyhyZWZsZWN0aW5nOiBzZWd1ZSkgfV0gc2VndWUsIF8gaW4KCQkJZ3VhcmQgbGV0IGRlc3RpbmF0aW9uID0gc2VndWUuZGVzdGluYXRpb25WaWV3Q29udHJvbGxlcihvZlR5cGU6IERlc3RpbmF0aW9uLnNlbGYpIGVsc2UgewoJCQkJZmF0YWxFcnJvcigiXChzZWd1ZURlc2NyaXB0aW9uKCkpOiBleHBlY3RlZCBkZXN0aW5hdGlvbiB2aWV3IGNvbnRyb2xsZXIgaGllcmFyY2h5IHRvIGluY2x1ZGUgXChEZXN0aW5hdGlvbi5zZWxmKSIpCgkJCX0KCgkJCXByZXBhcmUoZGVzdGluYXRpb24pCgkJfQoJfQoKLy8gc3dpZnRsaW50OmRpc2FibGUgZm9yY2VfdHJ5CglpbnRlcm5hbCBmdW5jIHBlcmZvcm1TZWd1ZSh3aXRoSWRlbnRpZmllciBpZGVudGlmaWVyOiBTdHJpbmcsIHNlbmRlcjogQW55PyA9IG5pbCwgcHJlcGFyZTogQGVzY2FwaW5nIChOU1N0b3J5Ym9hcmRTZWd1ZSwgQW55PykgLT4gVm9pZCkgewoJCV8gPSB0cnkhIGFzcGVjdF9ob29rKCNzZWxlY3RvcihOU1ZpZXdDb250cm9sbGVyLnByZXBhcmUoZm9yOnNlbmRlcjopKSwgb3B0aW9uczogLm9wdGlvbkF1dG9tYXRpY1JlbW92YWwpIHsgaW5mbyBpbgoJCQlsZXQgYXJndW1lbnRzID0gaW5mby5hcmd1bWVudHMoKSEKCQkJcHJlcGFyZShhcmd1bWVudHMuZmlyc3QgYXMhIE5TU3Rvcnlib2FyZFNlZ3VlLCBhcmd1bWVudHMuc2Vjb25kKQoJCX0KCgkJcGVyZm9ybVNlZ3VlKHdpdGhJZGVudGlmaWVyOiBpZGVudGlmaWVyLCBzZW5kZXI6IHNlbmRlcikKCX0KLy8gc3dpZnRsaW50OmVuYWJsZSBmb3JjZV90cnkKfQoKZXh0ZW5zaW9uIE5TVmlld0NvbnRyb2xsZXIgewoJaW50ZXJuYWwgdmFyIHNlZ3VlQ29udHJvbGxlcjogQW55PyB7IHJldHVybiBzZWxmIH0KCglwdWJsaWMgZnVuYyBwZXJmb3JtPERlc3RpbmF0aW9uOiBOU1ZpZXdDb250cm9sbGVyPihfIHNlZ3VlOiBBbnlTZWd1ZSwgcHJlcGFyZTogQGVzY2FwaW5nIChEZXN0aW5hdGlvbikgLT4gVm9pZCA9IHsgXyBpbiB9KSB7CgkJZ3VhcmQgbGV0IGlkZW50aWZpZXIgPSBzZWd1ZS5pZGVudGlmaWVyIGVsc2UgewoJCQlhc3NlcnRpb25GYWlsdXJlKCJjYW5ub3QgcGVyZm9ybSBzZWd1ZSBcKHNlZ3VlLmtpbmQpIHdpdGggZGVzdGluYXRpb24gXChEZXN0aW5hdGlvbi5zZWxmKSBiZWNhdXNlIGl0IGhhcyBubyBpZGVudGlmZXIiKQoJCQlyZXR1cm4KCQl9CgoJCWd1YXJkIHNlZ3VlLnR5cGUgPT0gRGVzdGluYXRpb24uc2VsZiBlbHNlIHsKCQkJZmF0YWxFcnJvcigiXChzZWd1ZS50eXBlKSBzaG91bGQgYmUgc2FtZSBhcyBEZXN0aW5hdGlvbiAoXChEZXN0aW5hdGlvbi5zZWxmKSkiKQoJCX0KCgkJcGVyZm9ybVNlZ3VlKHdpdGhJZGVudGlmaWVyOiBpZGVudGlmaWVyKSB7IFtzZWd1ZURlc2NyaXB0aW9uID0geyBTdHJpbmcocmVmbGVjdGluZzogc2VndWUpIH1dIHNlZ3VlLCBfIGluCgkJCWd1YXJkIGxldCBkZXN0aW5hdGlvbiA9IHNlZ3VlLmRlc3RpbmF0aW9uVmlld0NvbnRyb2xsZXIob2ZUeXBlOiBEZXN0aW5hdGlvbi5zZWxmKSBlbHNlIHsKCQkJCWZhdGFsRXJyb3IoIlwoc2VndWVEZXNjcmlwdGlvbigpKTogZXhwZWN0ZWQgZGVzdGluYXRpb24gdmlldyBjb250cm9sbGVyIGhpZXJhcmNoeSB0byBpbmNsdWRlIFwoRGVzdGluYXRpb24uc2VsZikiKQoJCQl9CgoJCQlwcmVwYXJlKGRlc3RpbmF0aW9uKQoJCX0KCX0KCglwdWJsaWMgZnVuYyBwZXJmb3JtT3JpZ2luYWw8RGVzdGluYXRpb24+KF8gc2VndWU6IFNlZ3VlPERlc3RpbmF0aW9uPiwgcHJlcGFyZTogQGVzY2FwaW5nIChEZXN0aW5hdGlvbikgLT4gVm9pZCA9IHsgXyBpbiB9KSB7CgkJZ3VhcmQgbGV0IGlkZW50aWZpZXIgPSBzZWd1ZS5pZGVudGlmaWVyIGVsc2UgewoJCQlhc3NlcnRpb25GYWlsdXJlKCJjYW5ub3QgcGVyZm9ybSBzZWd1ZSBcKHNlZ3VlLmtpbmQpIHdpdGggZGVzdGluYXRpb24gXChEZXN0aW5hdGlvbi5zZWxmKSBiZWNhdXNlIGl0IGhhcyBubyBpZGVudGlmZXIiKQoJCQlyZXR1cm4KCQl9CgoJCWd1YXJkIHNlZ3VlLnR5cGUgPT0gRGVzdGluYXRpb24uc2VsZiBlbHNlIHsKCQkJZmF0YWxFcnJvcigiXChzZWd1ZS50eXBlKSBzaG91bGQgYmUgc2FtZSBhcyBEZXN0aW5hdGlvbiAoXChEZXN0aW5hdGlvbi5zZWxmKSkiKQoJCX0KCQkKCQlwZXJmb3JtU2VndWUod2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIpIHsgW3NlZ3VlRGVzY3JpcHRpb24gPSB7IFN0cmluZyhyZWZsZWN0aW5nOiBzZWd1ZSkgfV0gc2VndWUsIF8gaW4KCQkJZ3VhcmQgbGV0IGRlc3RpbmF0aW9uID0gc2VndWUuZGVzdGluYXRpb25WaWV3Q29udHJvbGxlcihvZlR5cGU6IERlc3RpbmF0aW9uLnNlbGYpIGVsc2UgewoJCQkJZmF0YWxFcnJvcigiXChzZWd1ZURlc2NyaXB0aW9uKCkpOiBleHBlY3RlZCBkZXN0aW5hdGlvbiB2aWV3IGNvbnRyb2xsZXIgaGllcmFyY2h5IHRvIGluY2x1ZGUgXChEZXN0aW5hdGlvbi5zZWxmKSIpCgkJCX0KCgkJCXByZXBhcmUoZGVzdGluYXRpb24pCgkJfQoJfQoKLy8gc3dpZnRsaW50OmRpc2FibGUgZm9yY2VfdHJ5CglpbnRlcm5hbCBmdW5jIHBlcmZvcm1TZWd1ZSh3aXRoSWRlbnRpZmllciBpZGVudGlmaWVyOiBTdHJpbmcsIHNlbmRlcjogQW55PyA9IG5pbCwgcHJlcGFyZTogQGVzY2FwaW5nIChOU1N0b3J5Ym9hcmRTZWd1ZSwgQW55PykgLT4gVm9pZCkgewoJCV8gPSB0cnkhIGFzcGVjdF9ob29rKCNzZWxlY3RvcihOU1ZpZXdDb250cm9sbGVyLnByZXBhcmUoZm9yOnNlbmRlcjopKSwgb3B0aW9uczogLm9wdGlvbkF1dG9tYXRpY1JlbW92YWwpIHsgaW5mbyBpbgoJCQlsZXQgYXJndW1lbnRzID0gaW5mby5hcmd1bWVudHMoKSEKCQkJcHJlcGFyZShhcmd1bWVudHMuZmlyc3QgYXMhIE5TU3Rvcnlib2FyZFNlZ3VlLCBhcmd1bWVudHMuc2Vjb25kKQoJCX0KCgkJcGVyZm9ybVNlZ3VlKHdpdGhJZGVudGlmaWVyOiBpZGVudGlmaWVyLCBzZW5kZXI6IHNlbmRlcikKCX0KLy8gc3dpZnRsaW50OmVuYWJsZSBmb3JjZV90cnkKfQoKZXh0ZW5zaW9uIE5TVmlld0NvbnRyb2xsZXIgewoJcHVibGljIGZ1bmMgY2hpbGRWaWV3Q29udHJvbGxlcjxDaGlsZDogTlNWaWV3Q29udHJvbGxlcj4ob2ZUeXBlIHR5cGU6IENoaWxkLlR5cGUpIC0+IENoaWxkPyB7CgkJcmV0dXJuIGhpZXJhcmNoeS5maXJzdCB7ICQwIGFzPyBDaGlsZCB9Cgl9CgoJdmFyIGhpZXJhcmNoeTogQW55U2VxdWVuY2U8TlNWaWV3Q29udHJvbGxlcj4gewoJCXJldHVybiBBbnlTZXF1ZW5jZSB7ICgpIC0+IEFueUl0ZXJhdG9yPE5TVmlld0NvbnRyb2xsZXI+IGluCgkJCXZhciBxdWV1ZSA9IFtzZWxmXQoKCQkJcmV0dXJuIEFueUl0ZXJhdG9yIHsKCQkJCWlmIGxldCBuZXh0ID0gcXVldWUucG9wTGFzdCgpIHsKCQkJCQlxdWV1ZS5pbnNlcnQoY29udGVudHNPZjogbmV4dC5jaGlsZHJlbiwgYXQ6IDApCgkJCQkJcmV0dXJuIG5leHQKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIG5pbAoJCQkJfQoJCQl9CgkJfQoJfQp9CgpleHRlbnNpb24gTlNTcGxpdFZpZXdDb250cm9sbGVyIHsKCXB1YmxpYyBmdW5jIGNvbmZpZ3VyZVZpZXdDb250cm9sbGVycyhfIGNvbmZpZ3VyZTogKE5TVmlld0NvbnRyb2xsZXIpIC0+IFZvaWQpIHsKCQlsZXQgaGllcmFyY2h5ID0gc3BsaXRWaWV3SXRlbXMubGF6eS5mbGF0TWFwIHsgJDAudmlld0NvbnRyb2xsZXIuaGllcmFyY2h5IH0KCQloaWVyYXJjaHkuZm9yRWFjaChjb25maWd1cmUpCgl9Cn0KI2Vsc2UKLy9wdWJsaWMgZW51bSBOYXRhbGllIHsKcHVibGljIHN0cnVjdCBTZWd1ZSB7CglwdWJsaWMgbGV0IGlkZW50aWZpZXI6IFN0cmluZwoJbGV0IGtpbmQ6IFNlZ3VlS2luZD8KCWxldCB0eXBlOiBVSVZpZXdDb250cm9sbGVyLlR5cGUKCXB1YmxpYyBpbml0KF8gaWRlbnRpZmllcjogU3RyaW5nLCBfIGtpbmQ6IFN0cmluZywgXyB0eXBlOiBVSVZpZXdDb250cm9sbGVyLlR5cGUgPSBVSVZpZXdDb250cm9sbGVyLnNlbGYpIHsKCQlzZWxmLmlkZW50aWZpZXIgPSBpZGVudGlmaWVyCgkJc2VsZi5raW5kID0gU2VndWVLaW5kKHJhd1ZhbHVlOiBraW5kKQoJCXNlbGYudHlwZSA9IHR5cGUKCX0KfQoKcHVibGljIHN0cnVjdCBSZXVzYWJsZSB7CglwdWJsaWMgbGV0IGlkZW50aWZpZXI6IFN0cmluZwoJbGV0IGtpbmQ6IFJldXNhYmxlS2luZD8KCWxldCB0eXBlOiBVSVZpZXcuVHlwZQoJcHVibGljIGluaXQoXyBpZGVudGlmaWVyOiBTdHJpbmcsIF8ga2luZDogU3RyaW5nLCBfIHR5cGU6IFR5cGUpIHsKCQlzZWxmLmlkZW50aWZpZXIgPSBpZGVudGlmaWVyCgkJc2VsZi5raW5kID0gUmV1c2FibGVLaW5kKHJhd1ZhbHVlOiBraW5kKQoJCXNlbGYudHlwZSA9IHR5cGUKCX0KfQovL30KZXh0ZW5zaW9uIFVJU3Rvcnlib2FyZFNlZ3VlIHsKCUBub25vYmpjCglwdWJsaWMgZmluYWwgZnVuYyBkZXN0aW5hdGlvblZpZXdDb250cm9sbGVyPERlc3RpbmF0aW9uOiBVSVZpZXdDb250cm9sbGVyPihvZlR5cGUgdHlwZTogRGVzdGluYXRpb24uVHlwZSkgLT4gRGVzdGluYXRpb24/IHsKCQlyZXR1cm4gZGVzdGluYXRpb24uY2hpbGRWaWV3Q29udHJvbGxlcihvZlR5cGU6IHR5cGUpCgl9Cn0KCmV4dGVuc2lvbiBVSVZpZXdDb250cm9sbGVyIHsKCWludGVybmFsIHZhciBzZWd1ZUNvbnRyb2xsZXI6IEFueT8geyByZXR1cm4gc2VsZiB9CgoJcHVibGljIGZ1bmMgcGVyZm9ybTxEZXN0aW5hdGlvbj4oXyBzZWd1ZTogU2VndWU8RGVzdGluYXRpb24+LCBwcmVwYXJlOiBAZXNjYXBpbmcgKERlc3RpbmF0aW9uKSAtPiBWb2lkID0geyBfIGluIH0pIHsKCQlwZXJmb3JtU2VndWUod2l0aElkZW50aWZpZXI6IHNlZ3VlLmlkZW50aWZpZXIpIHsgW3NlZ3VlRGVzY3JpcHRpb24gPSB7IFN0cmluZyhyZWZsZWN0aW5nOiBzZWd1ZSkgfV0gc2VndWUsIF8gaW4KCQkJZ3VhcmQgbGV0IGRlc3RpbmF0aW9uID0gc2VndWUuZGVzdGluYXRpb25WaWV3Q29udHJvbGxlcihvZlR5cGU6IERlc3RpbmF0aW9uLnNlbGYpIGVsc2UgewoJCQkJZmF0YWxFcnJvcigiXChzZWd1ZURlc2NyaXB0aW9uKCkpOiBleHBlY3RlZCBkZXN0aW5hdGlvbiB2aWV3IGNvbnRyb2xsZXIgaGllcmFyY2h5IHRvIGluY2x1ZGUgXChEZXN0aW5hdGlvbi5zZWxmKSIpCgkJCX0KCgkJCXByZXBhcmUoZGVzdGluYXRpb24pCgkJfQoJfQoKLy8gc3dpZnRsaW50OmRpc2FibGUgZm9yY2VfdHJ5CglpbnRlcm5hbCBmdW5jIHBlcmZvcm1TZWd1ZSh3aXRoSWRlbnRpZmllciBpZGVudGlmaWVyOiBTdHJpbmcsIHNlbmRlcjogQW55PyA9IG5pbCwgcHJlcGFyZTogQGVzY2FwaW5nIChVSVN0b3J5Ym9hcmRTZWd1ZSwgQW55PykgLT4gVm9pZCkgewoJCV8gPSB0cnkhIGFzcGVjdF9ob29rKCNzZWxlY3RvcihVSVZpZXdDb250cm9sbGVyLnByZXBhcmUoZm9yOnNlbmRlcjopKSwgb3B0aW9uczogLm9wdGlvbkF1dG9tYXRpY1JlbW92YWwpIHsgaW5mbyBpbgoJCQlsZXQgYXJndW1lbnRzID0gaW5mby5hcmd1bWVudHMoKSEKCQkJcHJlcGFyZShhcmd1bWVudHMuZmlyc3QgYXMhIFVJU3Rvcnlib2FyZFNlZ3VlLCBhcmd1bWVudHMuc2Vjb25kKQoJCX0KCgkJcGVyZm9ybVNlZ3VlKHdpdGhJZGVudGlmaWVyOiBpZGVudGlmaWVyLCBzZW5kZXI6IHNlbmRlcikKCX0KLy8gc3dpZnRsaW50OmVuYWJsZSBmb3JjZV90cnkKfQoKZXh0ZW5zaW9uIFVJVmlld0NvbnRyb2xsZXIgewoJQGF2YWlsYWJsZSgqLCB1bmF2YWlsYWJsZSkKCXB1YmxpYyBmdW5jIHBlcmZvcm0oKSB7CgkJZmF0YWxFcnJvcigiVGhpcyBtZXRob2Qgd2lsbCBuZXZlciBiZSBjYWxsZWQsIGFuZCBleGlzdHMgb25seSB0byByZW1vdmUgYW4gYXBwYXJlbnQgYW1iaWd1aXR5IHJlc29sdmluZyB0aGUgZ2VuZXJpYyBtZXRob2QgJ3BlcmZvcm0oXzpwcmVwYXJlOiknIikKCX0KfQoKZXh0ZW5zaW9uIFVJVGFiQmFyQ29udHJvbGxlciB7CiAgcHVibGljIGZ1bmMgY29uZmlndXJlVmlld0NvbnRyb2xsZXJzKF8gY29uZmlndXJlOiAoVUlWaWV3Q29udHJvbGxlcikgLT4gVm9pZCkgewogICAgbGV0IGhpZXJhcmNoeSA9ICh2aWV3Q29udHJvbGxlcnMgPz8gW10pLmxhenkuZmxhdE1hcCB7ICQwLmhpZXJhcmNoeSB9CiAgICBoaWVyYXJjaHkuZm9yRWFjaChjb25maWd1cmUpCiAgfQp9CgpleHRlbnNpb24gVUlWaWV3Q29udHJvbGxlciB7CglwdWJsaWMgZnVuYyBjaGlsZFZpZXdDb250cm9sbGVyPENoaWxkOiBVSVZpZXdDb250cm9sbGVyPihvZlR5cGUgdHlwZTogQ2hpbGQuVHlwZSkgLT4gQ2hpbGQ/IHsKCQlyZXR1cm4gaGllcmFyY2h5LmZpcnN0IHsgJDAgYXM/IENoaWxkIH0KCX0KCgl2YXIgaGllcmFyY2h5OiBBbnlTZXF1ZW5jZTxVSVZpZXdDb250cm9sbGVyPiB7CgkJcmV0dXJuIEFueVNlcXVlbmNlIHsgKCkgLT4gQW55SXRlcmF0b3I8VUlWaWV3Q29udHJvbGxlcj4gaW4KCQkJdmFyIHF1ZXVlID0gW3NlbGZdCgoJCQlyZXR1cm4gQW55SXRlcmF0b3IgewoJCQkJaWYgbGV0IG5leHQgPSBxdWV1ZS5wb3BMYXN0KCkgewoJCQkJCXF1ZXVlLmluc2VydChjb250ZW50c09mOiBuZXh0LmNoaWxkVmlld0NvbnRyb2xsZXJzLCBhdDogMCkKCQkJCQlyZXR1cm4gbmV4dAoJCQkJfSBlbHNlIHsKCQkJCQlyZXR1cm4gbmlsCgkJCQl9CgkJCX0KCQl9Cgl9Cn0KI2VuZGlmCgovLyBNQVJLOiAtIFN0b3J5Ym9hcmRzCmV4dGVuc2lvbiBOU1N0b3J5Ym9hcmQgewoJZnVuYyBpbnN0YW50aWF0ZVZpZXdDb250cm9sbGVyPFQ6IE5TV2luZG93Q29udHJvbGxlcj4ob2ZUeXBlIHR5cGU6IFQuVHlwZSkgLT4gVD8gd2hlcmUgVDogSWRlbnRpZmlhYmxlUHJvdG9jb2wgewoJCWxldCBpbnN0YW5jZSA9IHR5cGUuaW5pdCgpCgkJaWYgbGV0IGlkZW50aWZpZXIgPSBpbnN0YW5jZS5zdG9yeWJvYXJkSWRlbnRpZmllciB7CgkJCXJldHVybiBzZWxmLmluc3RhbnRpYXRlQ29udHJvbGxlcih3aXRoSWRlbnRpZmllcjogaWRlbnRpZmllcikgYXM/IFQKCQl9CgkJcmV0dXJuIG5pbAoJfQoKCWZ1bmMgaW5zdGFudGlhdGVWaWV3Q29udHJvbGxlcjxUOiBOU1ZpZXdDb250cm9sbGVyPihvZlR5cGUgdHlwZTogVC5UeXBlKSAtPiBUPyB3aGVyZSBUOiBJZGVudGlmaWFibGVQcm90b2NvbCB7CgkJbGV0IGluc3RhbmNlID0gdHlwZS5pbml0KCkKCQlpZiBsZXQgaWRlbnRpZmllciA9IGluc3RhbmNlLnN0b3J5Ym9hcmRJZGVudGlmaWVyIHsKCQkJcmV0dXJuIHNlbGYuaW5zdGFudGlhdGVDb250cm9sbGVyKHdpdGhJZGVudGlmaWVyOiBpZGVudGlmaWVyKSBhcz8gVAoJCX0KCQlyZXR1cm4gbmlsCgl9Cn0KCnByb3RvY29sIFN0b3J5Ym9hcmQgewoJc3RhdGljIHZhciBzdG9yeWJvYXJkOiBOU1N0b3J5Ym9hcmQgeyBnZXQgfQoJc3RhdGljIHZhciBpZGVudGlmaWVyOiBOU1N0b3J5Ym9hcmQuTmFtZSB7IGdldCB9Cn0KCmV4dGVuc2lvbiBTdG9yeWJvYXJkIHsKCXN0YXRpYyB2YXIgc3Rvcnlib2FyZDogTlNTdG9yeWJvYXJkIHsKCQlyZXR1cm4gTlNTdG9yeWJvYXJkKG5hbWU6IHNlbGYuaWRlbnRpZmllciwgYnVuZGxlOiBuaWwpCgl9CgoJc3RhdGljIGZ1bmMgaW5zdGFudGlhdGVDb250cm9sbGVyKHdpdGhJZGVudGlmaWVyIGlkZW50aWZpZXI6IE5TU3Rvcnlib2FyZC5TY2VuZUlkZW50aWZpZXIpIC0+IE5TV2luZG93Q29udHJvbGxlciB7CgkJcmV0dXJuIHNlbGYuc3Rvcnlib2FyZC5pbnN0YW50aWF0ZUNvbnRyb2xsZXIod2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIpIGFzISBOU1dpbmRvd0NvbnRyb2xsZXIKCX0KCglzdGF0aWMgZnVuYyBpbnN0YW50aWF0ZVZpZXdDb250cm9sbGVyPFQ6IE5TV2luZG93Q29udHJvbGxlcj4ob2ZUeXBlIHR5cGU6IFQuVHlwZSkgLT4gVD8gd2hlcmUgVDogSWRlbnRpZmlhYmxlUHJvdG9jb2wgewoJCXJldHVybiBzZWxmLnN0b3J5Ym9hcmQuaW5zdGFudGlhdGVWaWV3Q29udHJvbGxlcihvZlR5cGU6IHR5cGUpCgl9CgoJc3RhdGljIGZ1bmMgaW5zdGFudGlhdGVDb250cm9sbGVyKHdpdGhJZGVudGlmaWVyIGlkZW50aWZpZXI6IE5TU3Rvcnlib2FyZC5TY2VuZUlkZW50aWZpZXIpIC0+IE5TVmlld0NvbnRyb2xsZXIgewoJCXJldHVybiBzZWxmLnN0b3J5Ym9hcmQuaW5zdGFudGlhdGVDb250cm9sbGVyKHdpdGhJZGVudGlmaWVyOiBpZGVudGlmaWVyKSBhcyEgTlNWaWV3Q29udHJvbGxlcgoJfQoKCXN0YXRpYyBmdW5jIGluc3RhbnRpYXRlVmlld0NvbnRyb2xsZXI8VDogTlNWaWV3Q29udHJvbGxlcj4ob2ZUeXBlIHR5cGU6IFQuVHlwZSkgLT4gVD8gd2hlcmUgVDogSWRlbnRpZmlhYmxlUHJvdG9jb2wgewoJCXJldHVybiBzZWxmLnN0b3J5Ym9hcmQuaW5zdGFudGlhdGVWaWV3Q29udHJvbGxlcihvZlR5cGU6IHR5cGUpCgl9Cn0KCi8vIE1BUks6IC0gUmV1c2FibGVLaW5kCnB1YmxpYyBlbnVtIFJldXNhYmxlS2luZDogU3RyaW5nLCBDdXN0b21TdHJpbmdDb252ZXJ0aWJsZSB7CiNpZiBvcyhtYWNPUykKCWNhc2UgdGFibGVDZWxsVmlldyA9ICJ0YWJsZUNlbGxWaWV3IgoJY2FzZSBjb2xsZWN0aW9uVmlld0l0ZW0gPSAiY29sbGVjdGlvblZpZXdJdGVtIgojZWxzZQoJY2FzZSB0YWJsZVZpZXdDZWxsID0gInRhYmxlVmlld0NlbGwiCgljYXNlIGNvbGxlY3Rpb25WaWV3Q2VsbCA9ICJjb2xsZWN0aW9uVmlld0NlbGwiCiNlbmRpZgoJcHVibGljIHZhciBkZXNjcmlwdGlvbjogU3RyaW5nIHsgcmV0dXJuIHNlbGYucmF3VmFsdWUgfQp9CgovLyBNQVJLOiAtIFNlZ3VlS2luZApwdWJsaWMgZW51bSBTZWd1ZUtpbmQ6IFN0cmluZywgQ3VzdG9tU3RyaW5nQ29udmVydGlibGUgewoJY2FzZSByZWxhdGlvbnNoaXAgPSAicmVsYXRpb25zaGlwIgoJY2FzZSBzaG93ID0gInNob3ciCgljYXNlIHNoZWV0ID0gInNoZWV0IgoJY2FzZSBwcmVzZW50YXRpb24gPSAicHJlc2VudGF0aW9uIgoJY2FzZSBlbWJlZCA9ICJlbWJlZCIKCWNhc2UgdW53aW5kID0gInVud2luZCIKCWNhc2UgcHVzaCA9ICJwdXNoIgoJY2FzZSBtb2RhbCA9ICJtb2RhbCIKCWNhc2UgcG9wb3ZlciA9ICJwb3BvdmVyIgoJY2FzZSByZXBsYWNlID0gInJlcGxhY2UiCgljYXNlIGN1c3RvbSA9ICJjdXN0b20iCgoJcHVibGljIHZhciBkZXNjcmlwdGlvbjogU3RyaW5nIHsgcmV0dXJuIHNlbGYucmF3VmFsdWUgfQp9CgovLyBNQVJLOiAtIElkZW50aWZpYWJsZVByb3RvY29sCnByb3RvY29sIElkZW50aWZpYWJsZVByb3RvY29sIHsvLyA6IEVxdWF0YWJsZSB7Cgl2YXIgc3Rvcnlib2FyZElkZW50aWZpZXI6IE5TU3Rvcnlib2FyZC5TY2VuZUlkZW50aWZpZXI/IHsgZ2V0IH0KfQoKLy8gTUFSSzogLSBTZWd1ZVByb3RvY29sCnByb3RvY29sIFNlZ3VlUHJvdG9jb2wgewoJdmFyIGlkZW50aWZpZXI6IE5TU3Rvcnlib2FyZFNlZ3VlLklkZW50aWZpZXI/IHsgZ2V0IH0KfQoKZnVuYyA9PTxUOiBTZWd1ZVByb3RvY29sLCBVOiBTZWd1ZVByb3RvY29sPihsaHM6IFQsIHJoczogVSkgLT4gQm9vbCB7CglyZXR1cm4gbGhzLmlkZW50aWZpZXIgPT0gcmhzLmlkZW50aWZpZXIKfQoKZnVuYyB+PTxUOiBTZWd1ZVByb3RvY29sLCBVOiBTZWd1ZVByb3RvY29sPihsaHM6IFQsIHJoczogVSkgLT4gQm9vbCB7CglyZXR1cm4gbGhzLmlkZW50aWZpZXIgPT0gcmhzLmlkZW50aWZpZXIKfQoKZnVuYyA9PTxUOiBTZWd1ZVByb3RvY29sPihsaHM6IFQsIHJoczogTlNTdG9yeWJvYXJkU2VndWUuSWRlbnRpZmllcikgLT4gQm9vbCB7CglyZXR1cm4gbGhzLmlkZW50aWZpZXIgPT0gcmhzCn0KCmZ1bmMgfj08VDogU2VndWVQcm90b2NvbD4obGhzOiBULCByaHM6IE5TU3Rvcnlib2FyZFNlZ3VlLklkZW50aWZpZXIpIC0+IEJvb2wgewoJcmV0dXJuIGxocy5pZGVudGlmaWVyID09IHJocwp9CgpmdW5jID09PFQ6IFNlZ3VlUHJvdG9jb2w+KGxoczogTlNTdG9yeWJvYXJkU2VndWUuSWRlbnRpZmllciwgcmhzOiBUKSAtPiBCb29sIHsKCXJldHVybiBsaHMgPT0gcmhzLmlkZW50aWZpZXIKfQoKZnVuYyB+PTxUOiBTZWd1ZVByb3RvY29sPihsaHM6IE5TU3Rvcnlib2FyZFNlZ3VlLklkZW50aWZpZXIsIHJoczogVCkgLT4gQm9vbCB7CglyZXR1cm4gbGhzID09IHJocy5pZGVudGlmaWVyCn0KCi8vIE1BUks6IC0gUHJvdG9jb2wgSW1wbGVtZW50YXRpb24KZXh0ZW5zaW9uIE5TU3Rvcnlib2FyZFNlZ3VlOiBTZWd1ZVByb3RvY29sIHsKfQoKLy8gTUFSSzogLSBOU1ZpZXdDb250cm9sbGVyIGV4dGVuc2lvbgpleHRlbnNpb24gTlNWaWV3Q29udHJvbGxlciB7CglmdW5jIHBlcmZvcm08VDogU2VndWVQcm90b2NvbD4oc2VndWU6IFQsIHNlbmRlcjogQW55PykgewoJCWlmIGxldCBpZGVudGlmaWVyID0gc2VndWUuaWRlbnRpZmllciB7CgkJCXBlcmZvcm1TZWd1ZSh3aXRoSWRlbnRpZmllcjogaWRlbnRpZmllciwgc2VuZGVyOiBzZW5kZXIpCgkJfQoJfQoKCWZ1bmMgcGVyZm9ybTxUOiBTZWd1ZVByb3RvY29sPihzZWd1ZTogVCkgewoJCXBlcmZvcm0oc2VndWU6IHNlZ3VlLCBzZW5kZXI6IG5pbCkKCX0KfQoKLy8gTUFSSzogLSBOU1dpbmRvd0NvbnRyb2xsZXIgZXh0ZW5zaW9uCmV4dGVuc2lvbiBOU1dpbmRvd0NvbnRyb2xsZXIgewoJZnVuYyBwZXJmb3JtPFQ6IFNlZ3VlUHJvdG9jb2w+KHNlZ3VlOiBULCBzZW5kZXI6IEFueT8pIHsKCQlpZiBsZXQgaWRlbnRpZmllciA9IHNlZ3VlLmlkZW50aWZpZXIgewoJCQlwZXJmb3JtU2VndWUod2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIsIHNlbmRlcjogc2VuZGVyKQoJCX0KCX0KCglmdW5jIHBlcmZvcm08VDogU2VndWVQcm90b2NvbD4oc2VndWU6IFQpIHsKCQlwZXJmb3JtKHNlZ3VlOiBzZWd1ZSwgc2VuZGVyOiBuaWwpCgl9Cn0KCi8vIE1BUks6IC0gUmV1c2FibGVWaWV3UHJvdG9jb2wKI2lmIG9zKG1hY09TKQpwcm90b2NvbCBSZXVzYWJsZVZpZXdQcm90b2NvbCB7Cgl2YXIgc3Rvcnlib2FyZElkZW50aWZpZXI6IE5TVXNlckludGVyZmFjZUl0ZW1JZGVudGlmaWVyPyB7IGdldCB9Cgl2YXIgdmlld1R5cGU6IE5TVmlldy5UeXBlPyB7IGdldCB9Cn0KCi8vIE1BUks6IC0gTlNDb2xsZWN0aW9uVmlldwpleHRlbnNpb24gTlNDb2xsZWN0aW9uVmlldyB7CglmdW5jIGRlcXVldWU8VDogUmV1c2FibGVWaWV3UHJvdG9jb2w+KHJldXNhYmxlOiBULCBmb3IgaW5kZXhQYXRoOiBJbmRleFBhdGgpIC0+IE5TQ29sbGVjdGlvblZpZXdJdGVtPyB7CgkJaWYgbGV0IGlkZW50aWZpZXIgPSByZXVzYWJsZS5zdG9yeWJvYXJkSWRlbnRpZmllciB7CgkJCXJldHVybiBtYWtlSXRlbSh3aXRoSWRlbnRpZmllcjogaWRlbnRpZmllciwgZm9yOiBpbmRleFBhdGgpCgkJfQoJCXJldHVybiBuaWwKCX0KCglmdW5jIHJlZ2lzdGVyPFQ6IFJldXNhYmxlVmlld1Byb3RvY29sPihyZXVzYWJsZTogVCkgewoJCWlmIGxldCB0eXBlID0gcmV1c2FibGUudmlld1R5cGUsIGxldCBpZGVudGlmaWVyID0gcmV1c2FibGUuc3Rvcnlib2FyZElkZW50aWZpZXIgewoJCQlyZWdpc3Rlcih0eXBlLCBmb3JJdGVtV2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIpCgkJfQoJfQoKCWZ1bmMgZGVxdWV1ZVJldXNhYmxlVmlldzxUOiBSZXVzYWJsZVZpZXdQcm90b2NvbD4ob2ZLaW5kIGVsZW1lbnRLaW5kOiBOU0NvbGxlY3Rpb25WaWV3LlN1cHBsZW1lbnRhcnlFbGVtZW50S2luZCwgcmV1c2FibGU6IFQsIGZvciBpbmRleFBhdGg6IEluZGV4UGF0aCkgLT4gTlNWaWV3PyB7CgkJaWYgbGV0IGlkZW50aWZpZXIgPSByZXVzYWJsZS5zdG9yeWJvYXJkSWRlbnRpZmllciB7CgkJCXJldHVybiBtYWtlU3VwcGxlbWVudGFyeVZpZXcob2ZLaW5kOiBlbGVtZW50S2luZCwgd2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIsIGZvcjogaW5kZXhQYXRoKQoJCX0KCQlyZXR1cm4gbmlsCgl9CgoJZnVuYyByZWdpc3RlclJldXNhYmxlVmlldzxUOiBSZXVzYWJsZVZpZXdQcm90b2NvbD4ob2ZLaW5kIGVsZW1lbnRLaW5kOiBOU0NvbGxlY3Rpb25WaWV3LlN1cHBsZW1lbnRhcnlFbGVtZW50S2luZCwgcmV1c2FibGU6IFQpIHsKCQlpZiBsZXQgdHlwZSA9IHJldXNhYmxlLnZpZXdUeXBlLCBsZXQgaWRlbnRpZmllciA9IHJldXNhYmxlLnN0b3J5Ym9hcmRJZGVudGlmaWVyIHsKCQkJcmVnaXN0ZXIodHlwZSwgZm9yU3VwcGxlbWVudGFyeVZpZXdPZktpbmQ6IGVsZW1lbnRLaW5kLCB3aXRoSWRlbnRpZmllcjogaWRlbnRpZmllcikKCQl9Cgl9Cn0KLy8gTUFSSzogLSBOU1RhYmxlVmlldwpleHRlbnNpb24gTlNUYWJsZVZpZXcgewoJZnVuYyBkZXF1ZXVlPFQ6IFJldXNhYmxlVmlld1Byb3RvY29sPihyZXVzYWJsZTogVCwgZm9yOiBJbmRleFBhdGgpIC0+IE5TVmlldz8gewoJCWlmIGxldCBpZGVudGlmaWVyID0gcmV1c2FibGUuc3Rvcnlib2FyZElkZW50aWZpZXIgewoJCQlyZXR1cm4gbWFrZVZpZXcod2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIsIG93bmVyOiBuaWwpCgkJfQoJCXJldHVybiBuaWwKCX0KCglmdW5jIHJlZ2lzdGVyPFQ6IFJldXNhYmxlVmlld1Byb3RvY29sPihyZXVzYWJsZTogVCwgbmliTmFtZTogTlNOaWIuTmFtZSwgYnVuZGxlIGJ1bmRsZU9yTmlsOiBCdW5kbGU/KSB7CgkJaWYgbGV0IGlkZW50aWZpZXIgPSByZXVzYWJsZS5zdG9yeWJvYXJkSWRlbnRpZmllciwKCQkJbGV0IG5pYiA9IE5TTmliKG5pYk5hbWVkOiBuaWJOYW1lLCBidW5kbGU6IGJ1bmRsZU9yTmlsKSB7CgkJCXJlZ2lzdGVyKG5pYiwgZm9ySWRlbnRpZmllcjogaWRlbnRpZmllcikKCQl9Cgl9CgoJZnVuYyByZWdpc3RlcjxUOiBSZXVzYWJsZVZpZXdQcm90b2NvbD4ocmV1c2FibGU6IFQsIG5pYkRhdGE6IERhdGEsIGJ1bmRsZSBidW5kbGVPck5pbDogQnVuZGxlPykgewoJCWlmIGxldCBpZGVudGlmaWVyID0gcmV1c2FibGUuc3Rvcnlib2FyZElkZW50aWZpZXIgewoJCQlsZXQgbmliID0gTlNOaWIobmliRGF0YTogbmliRGF0YSwgYnVuZGxlOiBidW5kbGVPck5pbCkKCQkJcmVnaXN0ZXIobmliLCBmb3JJZGVudGlmaWVyOiBpZGVudGlmaWVyKQoJCX0KCX0KfQoKZXh0ZW5zaW9uIE5TVGFibGVDZWxsVmlldzogUmV1c2FibGVWaWV3UHJvdG9jb2wgewoJcHVibGljIHZhciB2aWV3VHlwZTogTlNWaWV3LlR5cGU/IHsgcmV0dXJuIHR5cGUob2Y6IHNlbGYpIH0KCXB1YmxpYyB2YXIgc3Rvcnlib2FyZElkZW50aWZpZXI6IE5TVXNlckludGVyZmFjZUl0ZW1JZGVudGlmaWVyPyB7IHJldHVybiBzZWxmLmlkZW50aWZpZXIgfQp9CgpleHRlbnNpb24gTlNUYWJsZUhlYWRlclZpZXc6IFJldXNhYmxlVmlld1Byb3RvY29sIHsKCXB1YmxpYyB2YXIgdmlld1R5cGU6IE5TVmlldy5UeXBlPyB7IHJldHVybiB0eXBlKG9mOiBzZWxmKSB9CglwdWJsaWMgdmFyIHN0b3J5Ym9hcmRJZGVudGlmaWVyOiBOU1VzZXJJbnRlcmZhY2VJdGVtSWRlbnRpZmllcj8geyByZXR1cm4gc2VsZi5pZGVudGlmaWVyIH0KfQoKZXh0ZW5zaW9uIE5TVGFibGVSb3dWaWV3OiBSZXVzYWJsZVZpZXdQcm90b2NvbCB7CglwdWJsaWMgdmFyIHZpZXdUeXBlOiBOU1ZpZXcuVHlwZT8geyByZXR1cm4gdHlwZShvZjogc2VsZikgfQoJcHVibGljIHZhciBzdG9yeWJvYXJkSWRlbnRpZmllcjogTlNVc2VySW50ZXJmYWNlSXRlbUlkZW50aWZpZXI/IHsgcmV0dXJuIHNlbGYuaWRlbnRpZmllciB9Cn0KI2Vsc2UKcHJvdG9jb2wgUmV1c2FibGVWaWV3UHJvdG9jb2w6IElkZW50aWZpYWJsZVByb3RvY29sIHsKCXZhciB2aWV3VHlwZTogVUlWaWV3LlR5cGU/IHsgZ2V0IH0KfQoKLy8gTUFSSzogLSBVSUNvbGxlY3Rpb25WaWV3CmV4dGVuc2lvbiBVSUNvbGxlY3Rpb25WaWV3IHsKCWZ1bmMgZGVxdWV1ZTxUOiBSZXVzYWJsZVZpZXdQcm90b2NvbD4ocmV1c2FibGU6IFQsIGZvcjogSW5kZXhQYXRoKSAtPiBVSUNvbGxlY3Rpb25WaWV3Q2VsbD8gewoJCWlmIGxldCBpZGVudGlmaWVyID0gcmV1c2FibGUuc3Rvcnlib2FyZElkZW50aWZpZXIgewoJCQlyZXR1cm4gZGVxdWV1ZVJldXNhYmxlQ2VsbCh3aXRoUmV1c2VJZGVudGlmaWVyOiBpZGVudGlmaWVyLCBmb3I6IGBmb3JgKQoJCX0KCQlyZXR1cm4gbmlsCgl9CgoJZnVuYyByZWdpc3RlcjxUOiBSZXVzYWJsZVZpZXdQcm90b2NvbD4ocmV1c2FibGU6IFQpIHsKCQlpZiBsZXQgdHlwZSA9IHJldXNhYmxlLnZpZXdUeXBlLCBsZXQgaWRlbnRpZmllciA9IHJldXNhYmxlLnN0b3J5Ym9hcmRJZGVudGlmaWVyIHsKCQkJcmVnaXN0ZXIodHlwZSwgZm9yQ2VsbFdpdGhSZXVzZUlkZW50aWZpZXI6IGlkZW50aWZpZXIpCgkJfQoJfQoKCWZ1bmMgZGVxdWV1ZVJldXNhYmxlU3VwcGxlbWVudGFyeVZpZXdPZktpbmQ8VDogUmV1c2FibGVWaWV3UHJvdG9jb2w+KGVsZW1lbnRLaW5kOiBTdHJpbmcsIHdpdGhSZXVzYWJsZSByZXVzYWJsZTogVCwgZm9yOiBJbmRleFBhdGgpIC0+IFVJQ29sbGVjdGlvblJldXNhYmxlVmlldz8gewoJCWlmIGxldCBpZGVudGlmaWVyID0gcmV1c2FibGUuc3Rvcnlib2FyZElkZW50aWZpZXIgewoJCQlyZXR1cm4gZGVxdWV1ZVJldXNhYmxlU3VwcGxlbWVudGFyeVZpZXcob2ZLaW5kOiBlbGVtZW50S2luZCwgd2l0aFJldXNlSWRlbnRpZmllcjogaWRlbnRpZmllciwgZm9yOiBgZm9yYCkKCQl9CgkJcmV0dXJuIG5pbAoJfQoKCWZ1bmMgcmVnaXN0ZXI8VDogUmV1c2FibGVWaWV3UHJvdG9jb2w+KHJldXNhYmxlOiBULCBmb3JTdXBwbGVtZW50YXJ5Vmlld09mS2luZCBlbGVtZW50S2luZDogU3RyaW5nKSB7CgkJaWYgbGV0IHR5cGUgPSByZXVzYWJsZS52aWV3VHlwZSwgbGV0IGlkZW50aWZpZXIgPSByZXVzYWJsZS5zdG9yeWJvYXJkSWRlbnRpZmllciB7CgkJCXJlZ2lzdGVyKHR5cGUsIGZvclN1cHBsZW1lbnRhcnlWaWV3T2ZLaW5kOiBlbGVtZW50S2luZCwgd2l0aFJldXNlSWRlbnRpZmllcjogaWRlbnRpZmllcikKCQl9Cgl9Cn0KLy8gTUFSSzogLSBVSVRhYmxlVmlldwpleHRlbnNpb24gVUlUYWJsZVZpZXcgewoJZnVuYyBkZXF1ZXVlPFQ6IFJldXNhYmxlVmlld1Byb3RvY29sPihyZXVzYWJsZTogVCwgZm9yOiBJbmRleFBhdGgpIC0+IFVJVGFibGVWaWV3Q2VsbD8gewoJCWlmIGxldCBpZGVudGlmaWVyID0gcmV1c2FibGUuc3Rvcnlib2FyZElkZW50aWZpZXIgewoJCQlyZXR1cm4gZGVxdWV1ZVJldXNhYmxlQ2VsbCh3aXRoSWRlbnRpZmllcjogaWRlbnRpZmllciwgZm9yOiBgZm9yYCkKCQl9CgkJcmV0dXJuIG5pbAoJfQoKCWZ1bmMgcmVnaXN0ZXI8VDogUmV1c2FibGVWaWV3UHJvdG9jb2w+KHJldXNhYmxlOiBUKSB7CgkJaWYgbGV0IHR5cGUgPSByZXVzYWJsZS52aWV3VHlwZSwgbGV0IGlkZW50aWZpZXIgPSByZXVzYWJsZS5zdG9yeWJvYXJkSWRlbnRpZmllciB7CgkJCXJlZ2lzdGVyKHR5cGUsIGZvckNlbGxSZXVzZUlkZW50aWZpZXI6IGlkZW50aWZpZXIpCgkJfQoJfQoKCWZ1bmMgZGVxdWV1ZVJldXNhYmxlSGVhZGVyRm9vdGVyPFQ6IFJldXNhYmxlVmlld1Byb3RvY29sPihfIHJldXNhYmxlOiBUKSAtPiBVSVRhYmxlVmlld0hlYWRlckZvb3RlclZpZXc/IHsKCQlpZiBsZXQgaWRlbnRpZmllciA9IHJldXNhYmxlLnN0b3J5Ym9hcmRJZGVudGlmaWVyIHsKCQkJcmV0dXJuIGRlcXVldWVSZXVzYWJsZUhlYWRlckZvb3RlclZpZXcod2l0aElkZW50aWZpZXI6IGlkZW50aWZpZXIpCgkJfQoJCXJldHVybiBuaWwKCX0KCglmdW5jIHJlZ2lzdGVyUmV1c2FibGVIZWFkZXJGb290ZXI8VDogUmV1c2FibGVWaWV3UHJvdG9jb2w+KF8gcmV1c2FibGU6IFQpIHsKCQlpZiBsZXQgdHlwZSA9IHJldXNhYmxlLnZpZXdUeXBlLCBsZXQgaWRlbnRpZmllciA9IHJldXNhYmxlLnN0b3J5Ym9hcmRJZGVudGlmaWVyIHsKCQkJIHJlZ2lzdGVyKHR5cGUsIGZvckhlYWRlckZvb3RlclZpZXdSZXVzZUlkZW50aWZpZXI6IGlkZW50aWZpZXIpCgkJfQoJfQp9CgpleHRlbnNpb24gVUlUYWJsZVZpZXdDZWxsOiBSZXVzYWJsZVZpZXdQcm90b2NvbCB7CglwdWJsaWMgdmFyIHZpZXdUeXBlOiBVSVZpZXcuVHlwZT8geyByZXR1cm4gdHlwZShvZjogc2VsZikgfQoJcHVibGljIHZhciBzdG9yeWJvYXJkSWRlbnRpZmllcjogU3RyaW5nPyB7IHJldHVybiBzZWxmLnJldXNhYmxlSWRlbnRpZmllciB9Cn0KCmV4dGVuc2lvbiBVSUNvbGxlY3Rpb25SZXVzYWJsZVZpZXc6IFJldXNhYmxlVmlld1Byb3RvY29sIHsKCXB1YmxpYyB2YXIgdmlld1R5cGU6IFVJVmlldy5UeXBlPyB7IHJldHVybiB0eXBlKG9mOiBzZWxmKSB9CglwdWJsaWMgdmFyIHN0b3J5Ym9hcmRJZGVudGlmaWVyOiBTdHJpbmc/IHsgcmV0dXJuIHNlbGYucmV1c2FibGVJZGVudGlmaWVyIH0KfQojZW5kaWYgLy8gb3MoaU9TKQoKZnVuYyA9PTxUOiBSZXVzYWJsZVZpZXdQcm90b2NvbCwgVTogUmV1c2FibGVWaWV3UHJvdG9jb2w+KGxoczogVCwgcmhzOiBVKSAtPiBCb29sIHsKCXJldHVybiBsaHMuc3Rvcnlib2FyZElkZW50aWZpZXIgPT0gcmhzLnN0b3J5Ym9hcmRJZGVudGlmaWVyCn0K"
// swiftlint:enable line_length

do {
	if let natalieBase64Data = try Base64.decode(natalieBase64String),
		let string = String(data: natalieBase64Data, encoding: .utf8) {
		print(string)
	}
} catch {}
exit(0)
